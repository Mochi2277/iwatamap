<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç£ç”°å¸‚ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆãƒãƒƒãƒ—</title>
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
    .search-bar {
      margin-bottom: 10px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 8px;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h2>ç£ç”°å¸‚ãŠã™ã™ã‚ã‚¹ãƒãƒƒãƒˆãƒãƒƒãƒ—</h2>

  <input type="text" id="query" class="search-bar" placeholder="ä¾‹ï¼šå­ã©ã‚‚ã¨æ¥½ã—ã‚ã‚‹ã‚«ãƒ•ã‚§">
  <button onclick="searchSpots()">æ¤œç´¢</button>

  <div id="results"></div>
  <div id="map"></div>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAp2CHiYA0YHKfQv0tRQ1CILyWy_s4QdEI&callback=initMap" async defer></script>

  <!-- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ -->
  <script>
    let map;
    let markers = [];
    let spots = [];

    async function initMap() {
      const response = await fetch("data.json");
      spots = await response.json();

      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 34.7, lng: 137.85 },
        zoom: 12
      });

      displaySpots(spots.slice(0, 5));
    }

    function displaySpots(filtered) {
      // ãƒãƒ¼ã‚«ãƒ¼å‰Šé™¤
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      // HTMLçµæœã‚’åˆæœŸåŒ–
      const resultDiv = document.getElementById("results");
      resultDiv.innerHTML = "";

      filtered.forEach(spot => {
        // ãƒãƒ¼ã‚«ãƒ¼
        const marker = new google.maps.Marker({
          position: { lat: spot.geometry_lat, lng: spot.geometry_lng },
          map,
          title: spot.place_name
        });

        const infoWindow = new google.maps.InfoWindow({
          content: `<strong>${spot.place_name}</strong><br>${spot.description}`
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });

        markers.push(marker);

        // HTMLã‚«ãƒ¼ãƒ‰å‡ºåŠ›
        const card = `
          <div class="card">
            <h4>${spot.place_name}</h4>
            <p><strong>è©•ä¾¡:</strong> â­ï¸ ${spot.rating}ï¼ˆ${spot.user_ratings_total}ä»¶ï¼‰</p>
            <p>${spot.description}</p>
            <p><strong>ä½æ‰€:</strong> ${spot.formatted_address}</p>
            <a href="${spot.google_map_url}" target="_blank">ğŸ“ Googleãƒãƒƒãƒ—ã§é–‹ã</a>
          </div>`;
        resultDiv.insertAdjacentHTML("beforeend", card);
      });

      if (filtered.length > 0) {
        map.setCenter({ lat: filtered[0].geometry_lat, lng: filtered[0].geometry_lng });
      }
    }

    function searchSpots() {
      const query = document.getElementById("query").value.toLowerCase();
      const filtered = spots.filter(s => s.description && s.description.toLowerCase().includes(query));
      displaySpots(filtered.slice(0, 5));
    }
  </script>
</body>
</html>
